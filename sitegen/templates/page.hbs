<!DOCTYPE html>
<html lang='{{lang}}'>
<head>
    <meta charset='UTF-8'>
    <script>
        const p = window.location.pathname;
        if (!p.endsWith('/') && !p.split('/').pop().includes('.')) {
            window.location.replace(p + '/' + window.location.search + window.location.hash);
        }
    </script>
    <title>{{title}}</title>
    <link rel='icon' href='{{prefix}}favicon.svg' type='image/svg+xml'>
    <link rel='stylesheet' href='{{prefix}}style.css'>
</head>
<body>
<header>
    <button id="theme-toggle" aria-label="Toggle theme">
        <img id="sun-icon" src="{{prefix}}sun.svg" alt="Light theme">
        <img id="moon-icon" src="{{prefix}}moon.svg" alt="Dark theme" style="display:none;">
    </button>
    <h1>{{name}}</h1>
    {{{position_block}}}
    <p>{{date_str}}</p>
</header>
<div class='content'>
<img class='avatar' src='{{avatar_src}}' alt='Avatar'>
{{#if link_to_en}}<p><em><a href='{{link_to_en}}'>Ссылка на английскую версию</a></em></p>{{/if}}
{{{html_body}}}
</div>
<footer>
    <p><a href='{{pdf_typst_en}}'>Download PDF (EN)</a></p>
    <p><a href='{{pdf_typst_ru}}'>Скачать PDF (RU)</a></p>
</footer>
<script>
    const positions = {{{roles_js}}};
    const seg = window.location.pathname.split('/').filter(Boolean).pop();
    const position = document.getElementById('position');
    if (position && positions[seg]) { position.textContent = positions[seg]; }
</script>
<script>
    (function() {
        const getCookie = name => document.cookie.split("; ").find(r => r.startsWith(name + "="))?.split("=")[1];
        const setCookie = (name, value) => { document.cookie = name + "=" + value + "; path=/; max-age=31536000"; };
        const body = document.body;
        const button = document.getElementById("theme-toggle");
        const sun = document.getElementById("sun-icon");
        const moon = document.getElementById("moon-icon");
        const apply = theme => {
            if (theme === "dark") {
                body.classList.add("dark-theme");
                sun.style.display = "none";
                moon.style.display = "";
            } else {
                body.classList.remove("dark-theme");
                sun.style.display = "";
                moon.style.display = "none";
            }
        };
        apply(getCookie("theme"));
        button?.addEventListener("click", () => {
            const dark = body.classList.toggle("dark-theme");
            setCookie("theme", dark ? "dark" : "light");
            apply(dark ? "dark" : "light");
        });
    })();
</script>
</body>
</html>
